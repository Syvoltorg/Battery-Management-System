% MATLAB code for SoC drain comparison with specific battery parameters

% Parameters
initial_soc = 100; % Initial state of charge (fully charged at 100%)
time_hours = 0:0.5:2; % Time in hours (up to 2 hours with half-hour intervals)
temperature_range = 20:5:50; % Temperature range from 20°C to 50°C in 5°C steps

% Battery specifications
battery_capacity = 10; % Battery capacity in Ah
voltage = 36; % Rated voltage in volts
cycling_time_hours = 2; % Continuous cycling time in hours

% Discharge rate settings
reference_temperature = 25; % Reference temperature for normal discharge rate (25°C)
normal_discharge_rate = 1 / (battery_capacity * cycling_time_hours); % Base discharge rate at 25°C
temperature_discharge_factor = 0.002; % Additional SoC discharge factor per °C deviation from reference

% Initialize arrays to store results
soc_normal = initial_soc * exp(-normal_discharge_rate * time_hours); % SoC under normal operation (25°C)
soc_temp_dependant = zeros(length(time_hours), length(temperature_range)); % SoC under temperature-dependent operation

% Loop over temperature to calculate temperature-dependent SoC drain
for j = 1:length(temperature_range)
    current_temp = temperature_range(j);
    % Combined discharge rate for temperature-dependent operation
    discharge_rate = normal_discharge_rate + temperature_discharge_factor * (current_temp - reference_temperature);
    soc_temp_dependant(:, j) = initial_soc * exp(-discharge_rate * time_hours);
end

% Plotting the results
figure;

% Plot SoC under normal operation (25°C)
plot(time_hours, soc_normal, 'k--', 'LineWidth', 2);
hold on;

% Plot SoC under temperature-dependent operation for each temperature
for j = 1:length(temperature_range)
    plot(time_hours, soc_temp_dependant(:, j), 'LineWidth', 1.5);
end

% Add labels and legend
xlabel('Time (hours)');
ylabel('State of Charge (SoC)');
title('SoC Drain Comparison: Normal vs. Temperature-Dependent Operation');
legend(['Normal Operation (25°C)', ...
    arrayfun(@(x) sprintf('Temp = %d°C', x), temperature_range, 'UniformOutput', false)]);
grid on;
hold off;
